---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import TruckCard from '../../components/TruckCard.astro';
import TruckFilters from '../../components/TruckFilters.astro';
import { getAllTrucks, uniqueBrands, getTrucksByBrand, brands } from '../../data/trucksData';

const allTrucks = getAllTrucks();
---

<Layout 
  title="Danh sách xe tải - TruckSales | Hàng trăm xe tải chất lượng cao"
  description="Xem danh sách xe tải cũ và mới với đầy đủ thông tin chi tiết. Tìm kiếm và lọc xe tải theo thương hiệu, năm sản xuất, giá cả. Bảo hành đầy đủ, giao xe tận nơi."
>
  <Header />
  <main>
    <!-- Page Header -->
    <section class="bg-primary-600 text-white py-16">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-4">
            Danh sách xe tải
          </h1>
          <p class="text-xl text-gray-100 max-w-2xl mx-auto">
            Khám phá hàng trăm xe tải chất lượng cao với đầy đủ thông tin chi tiết
          </p>
        </div>
      </div>
    </section>
    
        <!-- Brand Tabs -->
        <section class="py-8 bg-white border-b">
          <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center gap-4">
              <button 
                class="brand-tab active px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-primary-600 text-white shadow-lg"
                data-brand="all"
              >
                Tất cả ({allTrucks.length})
              </button>
              {brands.map(brand => (
                <button 
                  class="brand-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-gray-100 text-gray-700 hover:bg-primary-100 hover:text-primary-700"
                  data-brand={brand.name}
                >
                  <div class="flex items-center space-x-2">
                    <img 
                      src={brand.image} 
                      alt={brand.name}
                      class="w-20 h-20 object-contain"
                    />
                    {/* <span>{brand.name}</span> */}
                    {/* <span class="bg-gray-200 text-gray-600 px-2 py-1 rounded-full text-xs">
                      {brand.slideProduct?.length || 0}
                    </span> */}
                  </div>
                </button>
              ))}
            </div>
          </div>
        </section>

        <!-- Filters and Results -->
        <section class="py-12">
          <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
              <!-- Filters Sidebar -->
              <div class="lg:col-span-1">
                <TruckFilters />
              </div>
              
              <!-- Results -->
              <div class="lg:col-span-3">
                <div class="flex items-center justify-between mb-6">
                  <h2 class="text-2xl font-bold text-gray-900" id="results-title">
                    Tất cả xe tải ({allTrucks.length} xe)
                  </h2>
                </div>
            
                <!-- All trucks view (default) -->
                <div id="trucks-all" class="trucks-section">
                  {brands.map(brand => {
                    const brandTrucks = brand.slideProduct || [];
                    
                    // Group trucks by series/type
                    const groupedTrucks = brandTrucks.reduce((groups, truck) => {
                      let series = 'Khác';
                      
                      if (brand.name === 'THACO TRUCK') {
                        if (truck.name.includes('TF')) series = 'TF';
                        else if (truck.name.includes('LINKER T2')) series = 'TẢI TRUNG THACO LINKER';
                        else if (truck.name.includes('LINKER T3')) series = 'TẢI BEN THACO LINKER';
                        else if (truck.name.includes('TOWNER VAN')) series = 'THACO TOWNER VAN';
                        else if (truck.name.includes('TOWNER TẢI')) series = 'THACO TOWNER TẢI';
                      } else if (brand.name === 'KIA') {
                        if (truck.name.includes('FRONTIER')) series = 'KIA FRONTIER';
                        else if (truck.name.includes('đông lạnh')) series = 'XE CHUYÊN DỤNG';
                      } else if (brand.name === 'MITSUBISHI FUSO') {
                        if (truck.name.includes('Canter')) series = 'FUSO CANTER';
                        else if (truck.name.includes('FI')) series = 'FUSO FI';
                        else if (truck.name.includes('FA')) series = 'FUSO FA';
                        else if (truck.name.includes('đông lạnh') || truck.name.includes('cánh dơi')) series = 'XE CHUYÊN DỤNG';
                      } else if (brand.name === 'SINOTRUK') {
                        if (truck.name.includes('HOWO')) series = 'HOWO';
                        else if (truck.name.includes('6x4') || truck.name.includes('4x2')) series = 'SINOTRUK';
                      } else if (brand.name === 'XE CHUYÊN DỤNG') {
                        series = 'XE CHUYÊN DỤNG';
                      } else if (brand.name === 'SƠ MI RƠ MOOC') {
                        series = 'SƠ MI RƠ MOOC';
                      }
                      
                      if (!groups[series]) {
                        groups[series] = [];
                      }
                      groups[series].push(truck);
                      return groups;
                    }, {});
                    
                    return (
                      <div class="mb-16" data-brand-section={brand.name}>
                        <!-- Brand Header -->
                        <div class="flex items-center mb-8">
                          <img 
                            src={brand.image} 
                            alt={brand.name}
                            class="w-16 h-16 object-contain mr-4"
                          />
                          <div>
                            <h3 class="text-3xl font-bold text-gray-900">
                              {brand.name}
                            </h3>
                            <p class="text-gray-600">
                              {brandTrucks.length} dòng xe đa dạng
                            </p>
                          </div>
                        </div>
                        
                        <!-- Brand Description -->
                        <div class="bg-gray-50 p-6 rounded-lg mb-8">
                          <p class="text-gray-700 leading-relaxed">
                            {brand.name} là thương hiệu xe tải uy tín với nhiều dòng sản phẩm đa dạng, 
                            từ xe tải nhẹ đến xe tải hạng nặng, đáp ứng mọi nhu cầu vận chuyển của khách hàng.
                          </p>
                        </div>
                        
                        <!-- Grouped Trucks by Series -->
                        {Object.entries(groupedTrucks).map(([series, trucks]) => (
                          <div class="mb-12">
                            <h4 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-primary-600 pl-4">
                              {series} ({trucks.length} xe)
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" data-brand={brand.name} data-series={series}>
                              {trucks.map(truck => (
                                <div data-truck={JSON.stringify(truck)}>
                                  <TruckCard truck={truck} />
                                </div>
                              ))}
                            </div>
                          </div>
                        ))}
                      </div>
                    );
                  })}
                </div>

                <!-- Individual brand sections (hidden by default) -->
                {brands.map(brand => {
                  const brandTrucks = brand.slideProduct || [];
                  
                  // Group trucks by series/type
                  const groupedTrucks = brandTrucks.reduce((groups, truck) => {
                    let series = 'Khác';
                    
                    if (brand.name === 'THACO TRUCK') {
                      if (truck.name.includes('TF')) series = 'TF';
                      else if (truck.name.includes('LINKER T2')) series = 'TẢI TRUNG THACO LINKER';
                      else if (truck.name.includes('LINKER T3')) series = 'TẢI BEN THACO LINKER';
                      else if (truck.name.includes('TOWNER VAN')) series = 'THACO TOWNER VAN';
                      else if (truck.name.includes('TOWNER TẢI')) series = 'THACO TOWNER TẢI';
                    } else if (brand.name === 'KIA') {
                      if (truck.name.includes('FRONTIER')) series = 'KIA FRONTIER';
                      else if (truck.name.includes('đông lạnh')) series = 'XE CHUYÊN DỤNG';
                    } else if (brand.name === 'MITSUBISHI FUSO') {
                      if (truck.name.includes('Canter')) series = 'FUSO CANTER';
                      else if (truck.name.includes('FI')) series = 'FUSO FI';
                      else if (truck.name.includes('FA')) series = 'FUSO FA';
                      else if (truck.name.includes('đông lạnh') || truck.name.includes('cánh dơi')) series = 'XE CHUYÊN DỤNG';
                    } else if (brand.name === 'SINOTRUK') {
                      if (truck.name.includes('HOWO')) series = 'HOWO';
                      else if (truck.name.includes('6x4') || truck.name.includes('4x2')) series = 'SINOTRUK';
                    } else if (brand.name === 'XE CHUYÊN DỤNG') {
                      series = 'XE CHUYÊN DỤNG';
                    } else if (brand.name === 'SƠ MI RƠ MOOC') {
                      series = 'SƠ MI RƠ MOOC';
                    }
                    
                    if (!groups[series]) {
                      groups[series] = [];
                    }
                    groups[series].push(truck);
                    return groups;
                  }, {});
                  
                  return (
                    <div id={`trucks-${brand.name.toLowerCase().replace(/\s+/g, '-')}`} class="trucks-section hidden">
                      <!-- Brand Header -->
                      <div class="flex items-center mb-8">
                        <img 
                          src={brand.image} 
                          alt={brand.name}
                          class="w-16 h-16 object-contain mr-4"
                        />
                        <div>
                          <h3 class="text-3xl font-bold text-gray-900">
                            {brand.name}
                          </h3>
                          <p class="text-gray-600">
                            {brandTrucks.length} dòng xe đa dạng
                          </p>
                        </div>
                      </div>
                      
                      <!-- Brand Description -->
                      <div class="bg-gray-50 p-6 rounded-lg mb-8">
                        <p class="text-gray-700 leading-relaxed">
                          {brand.name} là thương hiệu xe tải uy tín với nhiều dòng sản phẩm đa dạng, 
                          từ xe tải nhẹ đến xe tải hạng nặng, đáp ứng mọi nhu cầu vận chuyển của khách hàng.
                        </p>
                      </div>
                      
                      <!-- Grouped Trucks by Series -->
                      {Object.entries(groupedTrucks).map(([series, trucks]) => (
                        <div class="mb-12">
                          <h4 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-primary-600 pl-4">
                            {series} ({trucks.length} xe)
                          </h4>
                          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" data-brand={brand.name} data-series={series}>
                            {trucks.map(truck => (
                              <div data-truck={JSON.stringify(truck)}>
                                <TruckCard truck={truck} />
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  );
                })}
            
            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-12">
              <div class="text-6xl mb-4">🚚</div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">
                Không tìm thấy xe tải phù hợp
              </h3>
              <p class="text-gray-600 mb-4">
                Hãy thử điều chỉnh bộ lọc hoặc liên hệ với chúng tôi để được tư vấn
              </p>
              <a 
                href="/contact" 
                class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition-colors font-medium"
              >
                Liên hệ tư vấn
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

    <script>
      // Brand tab functionality
      document.addEventListener('DOMContentLoaded', function() {
        const brandTabs = document.querySelectorAll('.brand-tab');
        const trucksSections = document.querySelectorAll('.trucks-section');
        const resultsTitle = document.getElementById('results-title');
        const noResults = document.getElementById('no-results');
        
        function switchBrand(selectedBrand) {
          // Update tab styles
          brandTabs.forEach(tab => {
            if (tab.dataset.brand === selectedBrand) {
              tab.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-primary-100', 'hover:text-primary-700');
              tab.classList.add('bg-primary-600', 'text-white', 'shadow-lg');
            } else {
              tab.classList.remove('bg-primary-600', 'text-white', 'shadow-lg');
              tab.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-primary-100', 'hover:text-primary-700');
            }
          });
          
          // Hide all sections first
          trucksSections.forEach(section => {
            section.classList.add('hidden');
          });
          
          // Show specific section based on selected brand and scroll to it
          let targetSection;
          switch(selectedBrand) {
            case 'all':
              targetSection = document.getElementById('trucks-all');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'Tất cả xe tải (${allTrucks.length} xe)';
              }
              break;
              
            case 'THACO TRUCK':
              targetSection = document.getElementById('trucks-thaco-truck');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'THACO TRUCK xe tải';
              }
              break;
              
            case 'KIA':
              targetSection = document.getElementById('trucks-kia');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'KIA xe tải';
              }
              break;
              
            case 'MITSUBISHI FUSO':
              targetSection = document.getElementById('trucks-mitsubishi-fuso');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'MITSUBISHI FUSO xe tải';
              }
              break;
              
            case 'SINOTRUK':
              targetSection = document.getElementById('trucks-sinotruk');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'SINOTRUK xe tải';
              }
              break;
              
            case 'XE CHUYÊN DỤNG':
              targetSection = document.getElementById('trucks-xe-chuyên-dụng');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'XE CHUYÊN DỤNG xe tải';
              }
              break;
              
            case 'SƠ MI RƠ MOOC':
              targetSection = document.getElementById('trucks-sơ-mi-rơ-mooc');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'SƠ MI RƠ MOOC xe tải';
              }
              break;
              
            default:
              targetSection = document.getElementById('trucks-all');
              targetSection.classList.remove('hidden');
              if (resultsTitle) {
                resultsTitle.textContent = 'Tất cả xe tải (${allTrucks.length} xe)';
              }
          }
          
          // Smooth scroll to the target section
          if (targetSection) {
            setTimeout(() => {
              targetSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start',
                inline: 'nearest'
              });
            }, 100);
          }
          
          // Hide no results message
          if (noResults) {
            noResults.classList.add('hidden');
          }
        }
        
        // Add click event listeners to tabs
        brandTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            const selectedBrand = this.dataset.brand;
            switchBrand(selectedBrand);
          });
        });
        
        // Initialize with "all" selected
        switchBrand('all');
      });
    </script>
